<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursos CSS</title>

    <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="hero">
        <nav class="nav container">
            <div class="nav__logo">
                <h2 class="nav__title">Curso CSS.</h2>
            </div>
            <ul class="nav__link nav__link--menu">
                <li class="nav__items">
                    <a href="#" class="nav__links">Inicio</a>
                </li>
                <li class="nav__items">
                    <a href="#" class="nav__links">Acerca de</a>
                </li>
                <li class="nav__items">
                    <a href="#" class="nav__links">Contacto</a>
                </li>
                <li class="nav__items">
                    <a href="#" class="nav__links">Blog</a>
                </li>

                <img src="images/close.svg" alt="close" class="nav__close">
            </ul>

            <div class="nav__menu">
                <img src="images/menu.svg" alt="menu" class="nav__img">
            </div>
        </nav>

        <section class="hero__container container">
            <h1 class="hero__title">Aprende CSS3 desde CERO hasta dominarlo.</h1>
            <p class="hero__paragraph">
                Elige aprender CSS de una vez por todas, una vez que termines este curso
                ceras capaz de crear cualquier layout con CSS y crear tus propias animaciones.
            </p>
            <a href="#" class="cta">Comineza ahora</a>
        </section>
    </header>    

    <main>
        <section class="container about">
            <h2 class="subtitle">¿Que aprenderas en este curso?</h2>
            <p class="about__paragraph">
                Todo lo necesario y obligatorio de CSS, (Flexbox, Grid
                Custom properties, Position, Animation, Box Model y mas)
            </p>

            <div class="about__main">
                <article class="about__icons">
                    <img src="images/shapes.svg" alt="shapes" class="about__icon">
                    <h3 class="about__title">CSS Layouts</h3>
                    <p class="about__paragraph">
                        Lorem ipsum, dolor sit amet consectetur adipisicing elit. 
                        Que tampororo  proroo elus Facilis 
                    </p>
                </article>
                <article class="about__icons">
                    <img src="images/paint.svg" alt="paint" class="about__icon">
                    <h3 class="about__title">Animaciones</h3>
                    <p class="about__paragraph">
                        Lorem ipsum, dolor sit amet consectetur adipisicing elit. 
                        Que tampororo  proroo elus Facilis 
                    </p>
                </article>
                <article class="about__icons">
                    <img src="images/code.svg" alt="code" class="about__icon">
                    <h3 class="about__title">Saas</h3>
                    <p class="about__paragraph">
                        Lorem ipsum, dolor sit amet consectetur adipisicing elit. 
                        Que tampororo  proroo elus Facilis 
                    </p>
                </article>
            </div>
        </section>

        <section class="knowledge">
            <div class="knowledge__container container">
                <div class="knowledge__texts">
                    <h2 class="subtitle">
                        Curso completo de CSS3, Domina CSS de una vez por todas!
                    </h2>
                    <p class="knowledge__paragraph">
                        Lorem ipsum dolor sit amet consectetur adipisicing elit.
                         Repudiandae molestias velit suscipit natus recusandae voluptatem animi amet,
                          nostrum, sequi reprehenderit quod doloremque dolor autem, 
                          quisquam veniam sint ex. Architecto, hic.
                        </p>
                    <a href="#" class="cta">Entra al curso</a>
                </div>
                <figure class="knowledge__picture">
                    <img src="images/macbook.png" alt="macbook" class="knowledge__img">

                </figure>
            </div>
        </section>

        <section class="price container">
            <h2 class="subtitle">Obten el plan perfecto para aprender</h2>
            
            <div class="price__table">
            <div class="price__element">
                <p class="price__name">Flexbox</p>
                <h3 class="price__price">Free</h3>
                <div class="price__items">
                    <p class="price__features">Flexbox</p>
                    <p class="price__features">Layouts</p>
                    <p class="price__features">Responsive</p>
                </div>
                <a href="#" class="price__cta">Empieza ahora</a>
            </div>
            <div class="price__element price__element--best">
                <p class="price__name">Grid</p>
                <h3 class="price__price">$30/mes</h3>
                <div class="price__items">
                    <p class="price__features">Grid</p>
                    <p class="price__features">Implicit Grid</p>
                    <p class="price__features">Responsive</p>
                </div>
                <a href="#" class="price__cta">Empieza ahora</a>
            </div>
            <div class="price__element">
                <p class="price__name">Animaciones</p>
                <h3 class="price__price">$40/mes</h3>
                <div class="price__items">
                    <p class="price__features">Animation</p>
                    <p class="price__features">Transition</p>
                    <p class="price__features">Render Website</p>
                </div>
                <a href="#" class="price__cta">Empieza ahora</a>
            </div>
        </div>
        </section>

        <section class="testimony">
            <div class="testimony__container container">
                <img src="images/leftarrow.svg" alt="leftarrow" class="testimony__arrow" id="before">
                <section class="testimony__body testimony__body--show" data-id="1">
                    <div class="testimony__texts">
                        <h2 class="subtitle">Mi nombre es Jordan Alexander, 
                            <span class="testimony__course">estudiante de CSS.</span>
                        </h2>
                        <p class="testimony__review">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                            Quo, hic fugit. Ullam inventore, 
                            illum numquam quaerat quis reprehenderit, non officia, 
                            mollitia ratione natus voluptatum porro rerum sit error quidem possimus?
                        </p>
                    </div>
                    <figure>
                        <img src="images/face.jpg" alt="face" class="testimony__img">
                    </figure>
                </section>

                <section class="testimony__body" data-id="2">
                    <div class="testimony__texts">
                        <h2 class="subtitle">Mi nombre es Alejandra Perez, 
                            <span class="testimony__course">estudiante de CSS.</span>
                        </h2>
                        <p class="testimony__review">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                            Quo, hic fugit. Ullam inventore, 
                            illum numquam quaerat quis reprehenderit, non officia, 
                            mollitia ratione natus voluptatum porro rerum sit error quidem possimus?
                        </p>
                    </div>
                    <figure>
                        <img src="images/face2.jpg" alt="face2" class="testimony__img">
                    </figure>
                </section>
                <section class="testimony__body" data-id="3">
                    <div class="testimony__texts">
                        <h2 class="subtitle">Mi nombre es Jordan Alexander, 
                            <span class="testimony__course">estudiante de CSS.</span>
                        </h2>
                        <p class="testimony__review">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                            Quo, hic fugit. Ullam inventoressimus?
                        </p>
                    </div>
                    <figure>
                        <img src="images/face3.jpg" alt="face" class="testimony__img">
                    </figure>
                </section>

                <section class="testimony__body" data-id="4">
                    <div class="testimony__texts">
                        <h2 class="subtitle">Mi nombre es Bruse Lee, 
                            <span class="testimony__course">estudiante de CSS.</span>
                        </h2>
                        <p class="testimony__review">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                            Quo, hic fugit. Ullam inventoressimus?
                        </p>
                    </div>
                    <figure>
                        <img src="images/face4.jpg" alt="face" class="testimony__img">
                    </figure>
                </section>
                <img src="images/rightarrow.svg" alt="rightarrow" class="testimony__arrow" id="next">
            </div>
        </section>

        <section class="questions container">
            <h2 class="subtitle">Preguntas frecuentes</h2>
            <p class="questions__paragraph">
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Inventore quibusdam, amet dignissimos repellat eos dolore odio autem! Quaerat hic sint
            </p>
            <section class="questions__container">
                <article class="questions__padding">
                    <div class="questions__answer">
                        <h3 class="questions__title">
                            ¿Que es CSS?
                            <span class="questions__arrow">
                                <img src="images/arrow.svg" alt="arrow" class="questions__img">
                            </span>
                        </h3>
                        <p class="questions__show">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit.
                             Eaque ipsa dicta ex quibusdam accusamus pariatur velit eius,
                            voluptatibus natus animi esse accusantium,
                             veritatis vel recusandae hic iste ad libero reprehenderit!
                        </p>
                    </div>
                </article>
                <article class="questions__padding">
                    <div class="questions__answer">
                        <h3 class="questions__title">
                            ¿Que es CSS Grid?
                            <span class="questions__arrow">
                                <img src="images/arrow.svg" alt="arrow" class="questions__img">
                            </span>
                        </h3>
                        <p class="questions__show">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit.
                             Eaque ipsa dicta ex quibusdam accusamus pariatur velit eius,
                            voluptatibus natus animi esse accusantium,
                             veritatis vel recusandae hic iste ad libero reprehenderit!
                        </p>
                    </div>
                </article>
                <article class="questions__padding">
                    <div class="questions__answer">
                        <h3 class="questions__title">
                            ¿Que aprendere en este curso?
                            <span class="questions__arrow">
                                <img src="images/arrow.svg" alt="arrow" class="questions__img">
                            </span>
                        </h3>
                        <p class="questions__show">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit.
                             Eaque ipsa dicta ex quibusdam accusamus pariatur velit eius,
                            voluptatibus natus animi esse accusantium,
                             veritatis vel recusandae hic iste ad libero reprehenderit!
                        </p>
                    </div>
                </article>
            </section>

            <section class="questions__offer">
                <h2 class="subtitle">¿Estas listo para aprender CSS?</h2>
                <p class="questions__copy">
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit.
                     Cupiditate, officia omnis dolore nobis exercitationem dolores saepe accusantium, 
                     ducimus temporibus cum corrupti natus sapiente consequatur,
                     eum quae consectetur dolorem ab ipsum.
                </p>
                <a href="#" class="cta">Aprende ahora</a>
            </section>
        </section>
    </main>

    <footer class="footer">
        <section class="footer__container container">
            <nav class="nav nav--footer">
                <h2 class="footer__title">Curso CSS.</h2>
                <ul class="nav__link nav__link--footer">
                    <li class="nav__items">
                        <a href="#" class="nav__links">Inicio</a>
                    </li>
                    <li class="nav__items">
                        <a href="#" class="nav__links">Acerca de</a>
                    </li>
                    <li class="nav__items">
                        <a href="#" class="nav__links">Contacto</a>
                    </li>
                    <li class="nav__items">
                        <a href="#" class="nav__links">Blog</a>
                    </li>
                </ul>
            </nav>
            <form action="#" class="footer__form">
                <h2 class="footer__newsletter">Suscribite a la newsletter</h2>
                <div class="footer__inputs">
                    <input type="email" placeholder="obarra@test.com" class="footer__input">
                    <input type="submit" value="Registrate" class="footer__submit">
                </div>
            </form>
        </section>

        <section class="footer__copy container">
            <div class="footer__icons">
                <a href="#">
                    <img src="images/youtube.svg" alt="youtube" class="footer__img">
                </a>
                <a href="#">
                    <img src="images/twitter.svg" alt="twitter" class="footer__img">
                </a>
                <a href="#">
                    <img src="images/facebook.svg" alt="facebook" class="footer__img">
                </a>
            </div>
            <h3 class="footer__copyright">Derechos reservados &copy; Omar Barra</h3>
        </section>

    </footer>

    <script src="js/slider.js"></script>
    <script src="js/questions.js"></script>


    <div id="inner_content-105-28028" class="ct-inner-content">
        <p>Java 18, released on March 22, 2022, is the first "interim" release after the last Long-Term-Support (LTS) release, Java 17.</p>
        
        
        
        <p>With nine implemented JEPs, the scope of changes in Java 18 has decreased significantly compared to the previous releases. After the LTS release of Java 17, the JDK developers should take a little breather ;-)</p>
        
        
        
        <div class="lwptoc lwptoc-autoWidth lwptoc-light lwptoc-notInherit" data-smooth-scroll="1" data-smooth-scroll-offset="24" data-lwptoc-initialized="1"><div class="lwptoc_i">    <div class="lwptoc_header">
                <b class="lwptoc_title" style="font-weight:600;">Contents</b>                    <span class="lwptoc_toggle">
                        <a href="#" class="lwptoc_toggle_label" data-label="show">hide</a>
                    </span>
                    </div>
        <div class="lwptoc_items lwptoc_items-visible" style="font-size:95%;">
            <div class="lwptoc_itemWrap"><div class="lwptoc_item">    <a href="#UTF-8_by_Default">
                            <span class="lwptoc_item_number">1</span>
                        <span class="lwptoc_item_label">UTF-8 by Default</span>
            </a>
            <div class="lwptoc_itemWrap"><div class="lwptoc_item">    <a href="#CharsetforName_Taking_Fallback_Default_Value">
                            <span class="lwptoc_item_number">1.1</span>
                        <span class="lwptoc_item_label">Charset.forName() Taking Fallback Default Value</span>
            </a>
            </div></div></div><div class="lwptoc_item">    <a href="#Simple_Web_Server">
                            <span class="lwptoc_item_number">2</span>
                        <span class="lwptoc_item_label">Simple Web Server</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Code_Snippets_in_Java_API_Documentation">
                            <span class="lwptoc_item_number">3</span>
                        <span class="lwptoc_item_label">Code Snippets in Java API Documentation</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Internet-Address_Resolution_SPI">
                            <span class="lwptoc_item_number">4</span>
                        <span class="lwptoc_item_label">Internet-Address Resolution SPI</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Preview_and_Incubator-Features">
                            <span class="lwptoc_item_number">5</span>
                        <span class="lwptoc_item_label">Preview and Incubator-Features</span>
            </a>
            <div class="lwptoc_itemWrap"><div class="lwptoc_item">    <a href="#Pattern_Matching_for_switch_Second_Preview">
                            <span class="lwptoc_item_number">5.1</span>
                        <span class="lwptoc_item_label">Pattern Matching for switch (Second Preview)</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Vector_API_Third_Incubator">
                            <span class="lwptoc_item_number">5.2</span>
                        <span class="lwptoc_item_label">Vector API (Third Incubator)</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Foreign_Function_Memory_API_Second_Incubator">
                            <span class="lwptoc_item_number">5.3</span>
                        <span class="lwptoc_item_label">Foreign Function &amp; Memory API (Second Incubator)</span>
            </a>
            </div></div></div><div class="lwptoc_item">    <a href="#Deprecations_and_Deletions">
                            <span class="lwptoc_item_number">6</span>
                        <span class="lwptoc_item_label">Deprecations and Deletions</span>
            </a>
            <div class="lwptoc_itemWrap"><div class="lwptoc_item">    <a href="#Deprecate_Finalization_for_Removal">
                            <span class="lwptoc_item_number">6.1</span>
                        <span class="lwptoc_item_label">Deprecate Finalization for Removal</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Terminally_Deprecate_Threadstop">
                            <span class="lwptoc_item_number">6.2</span>
                        <span class="lwptoc_item_label">Terminally Deprecate Thread.stop</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Remove_the_Legacy_PlainSocketImpl_and_PlainDatagramSocketImpl_Implementation">
                            <span class="lwptoc_item_number">6.3</span>
                        <span class="lwptoc_item_label">Remove the Legacy PlainSocketImpl and PlainDatagramSocketImpl Implementation</span>
            </a>
            </div></div></div><div class="lwptoc_item">    <a href="#Other_Changes_in_Java_18">
                            <span class="lwptoc_item_number">7</span>
                        <span class="lwptoc_item_label">Other Changes in Java 18</span>
            </a>
            <div class="lwptoc_itemWrap"><div class="lwptoc_item">    <a href="#Reimplement_Core_Reflection_with_Method_Handles">
                            <span class="lwptoc_item_number">7.1</span>
                        <span class="lwptoc_item_label">Reimplement Core Reflection with Method Handles</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#ZGC_SerialGC_ParallelGC_Support_String_Deduplication">
                            <span class="lwptoc_item_number">7.2</span>
                        <span class="lwptoc_item_label">ZGC / SerialGC / ParallelGC Support String Deduplication</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Allow_G1_Heap_Regions_up_to_512_MB">
                            <span class="lwptoc_item_number">7.3</span>
                        <span class="lwptoc_item_label">Allow G1 Heap Regions up to 512 MB</span>
            </a>
            </div><div class="lwptoc_item">    <a href="#Complete_List_of_All_Changes_in_Java_18">
                            <span class="lwptoc_item_number">7.4</span>
                        <span class="lwptoc_item_label">Complete List of All Changes in Java 18</span>
            </a>
            </div></div></div><div class="lwptoc_item">    <a href="#Summary">
                            <span class="lwptoc_item_number">8</span>
                        <span class="lwptoc_item_label">Summary</span>
            </a>
            </div></div></div>
        </div></div><h2 class="wp-block-heading" id="utf-8-by-default"><span id="UTF-8_by_Default"><span id="UTF-8_by_Default">UTF-8 by Default</span></span></h2>
        
        
        
        <p>For a long time, we Java developers have had to deal with the fact that the standard Java character set varies depending on the operating system and language settings.</p>
        
        
        
        <p>This changes with Java 18 :-)</p>
        
        
        
        <h4 class="wp-block-heading"><span id="The_Problem">The Problem</span></h4>
        
        
        
        <p>The Java standard character set determines how Strings are converted to bytes and vice versa in numerous methods of the JDK class library (e.g., when writing and reading a text file). These include, for example:</p>
        
        
        
        <ul>
        <li>the constructors of <code>FileReader</code>, <code>FileWriter</code>, <code>InputStreamReader</code>, <code>OutputStreamWriter</code>, </li>
        
        
        
        <li>the constructors of <code>Formatter</code> and <code>Scanner</code>,</li>
        
        
        
        <li>the static methods <code>URLEncoder.encode()</code> and <code>URLDecoder.decode()</code>.</li>
        </ul>
        
        
        
        <p>This can lead to unpredictable behavior when an application is developed and tested in one environment – and then run in another (where Java chooses a different default character set).</p>
        
        
        
        <p>For example, let's run the following code on Linux or macOS (the Japanese text is "Happy Coding!" according to Google Translate):</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-1" data-shcb-language-name="Java" data-shcb-language-slug="java"><style>.wp-block-code {
            border: 0;
            padding: 0;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        .wp-block-code > span {
            display: block;
            overflow: auto;
        }
        
        .shcb-language {
            border: 0;
            clip: rect(1px, 1px, 1px, 1px);
            -webkit-clip-path: inset(50%);
            clip-path: inset(50%);
            height: 1px;
            margin: -1px;
            overflow: hidden;
            padding: 0;
            position: absolute;
            width: 1px;
            word-wrap: normal;
            word-break: normal;
        }
        
        .hljs {
            box-sizing: border-box;
        }
        
        .hljs.shcb-code-table {
            display: table;
            width: 100%;
        }
        
        .hljs.shcb-code-table > .shcb-loc {
            color: inherit;
            display: table-row;
            width: 100%;
        }
        
        .hljs.shcb-code-table .shcb-loc > span {
            display: table-cell;
        }
        
        .wp-block-code code.hljs:not(.shcb-wrap-lines) {
            white-space: pre;
        }
        
        .wp-block-code code.hljs.shcb-wrap-lines {
            white-space: pre-wrap;
        }
        
        .hljs.shcb-line-numbers {
            border-spacing: 0;
            counter-reset: line;
        }
        
        .hljs.shcb-line-numbers > .shcb-loc {
            counter-increment: line;
        }
        
        .hljs.shcb-line-numbers .shcb-loc > span {
            padding-left: 0.75em;
        }
        
        .hljs.shcb-line-numbers .shcb-loc::before {
            border-right: 1px solid #ddd;
            content: counter(line);
            display: table-cell;
            padding: 0 0.75em;
            text-align: right;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            white-space: nowrap;
            width: 1%;
        }
        </style><span><code class="hljs language-java"><span class="hljs-keyword">try</span> (FileWriter fw = <span class="hljs-keyword">new</span> FileWriter(<span class="hljs-string">"happy-coding.txt"</span>);
            BufferedWriter bw = <span class="hljs-keyword">new</span> BufferedWriter(fw)) {
          bw.write(<span class="hljs-string">"ハッピーコーディング！"</span>);
        }</code></span><small class="shcb-language" id="shcb-language-1"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>And then, we load this file with the following code on Windows:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-2" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-keyword">try</span> (FileReader fr = <span class="hljs-keyword">new</span> FileReader(<span class="hljs-string">"happy-coding.txt"</span>);
            BufferedReader br = <span class="hljs-keyword">new</span> BufferedReader(fr)) {
          String line = br.readLine();
          System.out.println(line);
        }</code></span><small class="shcb-language" id="shcb-language-2"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Then the following is displayed:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-3" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">ãƒ?ãƒƒãƒ”ãƒ¼ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼?</code></span><small class="shcb-language" id="shcb-language-3"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>That is because Linux and macOS store the file in UTF-8 format, and Windows tries to read it in Windows-1252 format.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="The_Problem_-_Stage_Two">The Problem – Stage Two</span></h4>
        
        
        
        <p>It becomes even more chaotic because newer class library methods do not respect the default character set but always use UTF-8 if no character set is specified. These methods include, for example, <code>Files.writeString()</code>, <code>Files.readString()</code>, <code>Files.newBufferedWriter()</code>, and <code>Files.newBufferedReader()</code>.</p>
        
        
        
        <p>Let's start the following program, which writes the Japanese text via <code>FileWriter</code> and reads it directly afterward via <code>Files.readString()</code>:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-4" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-keyword">try</span> (FileWriter fw = <span class="hljs-keyword">new</span> FileWriter(<span class="hljs-string">"happy-coding.txt"</span>);
            BufferedWriter bw = <span class="hljs-keyword">new</span> BufferedWriter(fw)) {
          bw.write(<span class="hljs-string">"ハッピーコーディング！"</span>);
        }
        
        String text = Files.readString(Path.of(<span class="hljs-string">"happy-coding.txt"</span>));
        System.out.println(text);</code></span><small class="shcb-language" id="shcb-language-4"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Linux and macOS display the correct Japanese text. On Windows, however, we see only question marks:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-5" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">???????????</code></span><small class="shcb-language" id="shcb-language-5"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>That is because, on Windows, <code>FileWriter</code> writes the file using the standard Java character set Windows-1252, but <code>Files.readString()</code> reads the file back in as UTF-8 – regardless of the standard character set.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="Possible_Solutions_to_Date">Possible Solutions to Date</span></h4>
        
        
        
        <p>For protecting an application against such errors, there have been two possibilities so far:</p>
        
        
        
        <ol>
        <li>Specify the character set when calling all methods that convert strings to bytes and vice versa.</li>
        
        
        
        <li>Set the default character set via system property "file.encoding".</li>
        </ol>
        
        
        
        <p>The first option leads to a lot of code duplication and is thus messy and error-prone:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-6" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">FileWriter fw = <span class="hljs-keyword">new</span> FileWriter(<span class="hljs-string">"happy-coding.txt"</span>, StandardCharsets.UTF_8);
        <span class="hljs-comment">// ...</span>
        FileReader fr = <span class="hljs-keyword">new</span> FileReader(<span class="hljs-string">"happy-coding.txt"</span>, StandardCharsets.UTF_8);
        <span class="hljs-comment">// ...</span>
        Files.readString(Path.of(<span class="hljs-string">"happy-coding.txt"</span>), StandardCharsets.UTF_8);</code></span><small class="shcb-language" id="shcb-language-6"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Specifying the character set parameters also prevents us from using method references, as in the following example:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-7" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">Stream&lt;String&gt; encodedParams = ...
        Stream&lt;String&gt; decodedParams = encodedParams.map(URLDecoder::decode);</code></span><small class="shcb-language" id="shcb-language-7"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Instead, we would have to write:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-8" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">Stream&lt;String&gt; encodedParams = ...
        Stream&lt;String&gt; decodedParams =
            encodedParams.map(s -&gt; URLDecoder.decode(s, StandardCharsets.UTF_8));</code></span><small class="shcb-language" id="shcb-language-8"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The second possibility (system property "file.encoding") was firstly not officially documented up to and including Java 17 (see <a rel="noopener" href="https://docs.oracle.com/en/java/javase/17/docs/api/system-properties.html" target="_blank">system properties documentation</a>).</p>
        
        
        
        <p>Secondly, as explained above, the character set specified is not used for all API methods. So the variant is also error-prone, as we can show with the example from above:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-9" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Jep400Example</span> </span>{
          <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>{
            <span class="hljs-keyword">try</span> (FileWriter fw = <span class="hljs-keyword">new</span> FileWriter(<span class="hljs-string">"happy-coding.txt"</span>);
                BufferedWriter bw = <span class="hljs-keyword">new</span> BufferedWriter(fw)) {
              bw.write(<span class="hljs-string">"ハッピーコーディング！"</span>);
            }
        
            String text = Files.readString(Path.of(<span class="hljs-string">"happy-coding.txt"</span>));
            System.out.println(text);
          }
        }</code></span><small class="shcb-language" id="shcb-language-9"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Let's run the program once with standard encoding US-ASCII:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-10" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">$ java -Dfile.encoding=US-ASCII Jep400Example.java
        ?????????????????????????????????</code></span><small class="shcb-language" id="shcb-language-10"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The result is garbage because <code>FileWriter</code> takes the default encoding into account, but <code>Files.readString()</code> ignores it and always uses UTF-8. So this variant only works reliably if you use UTF-8 uniformly:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-11" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">$ java -Dfile.encoding=UTF-8 Jep400Example.java
        ハッピーコーディング！</code></span><small class="shcb-language" id="shcb-language-11"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <h4 class="wp-block-heading"><span id="JEP_400_to_the_Rescue">JEP 400 to the Rescue</span></h4>
        
        
        
        <p>With <a rel="noopener" href="https://openjdk.org:443/jeps/400" target="_blank">JDK Enhancement Proposal 400</a>, the problems mentioned above will – at least for the most part – be a thing of the past as of Java 18.</p>
        
        
        
        <p>The default encoding will always be UTF-8 regardless of the operating system, locale, and language settings.</p>
        
        
        
        <p>Also, the system property "file.encoding" will be documented – and we can use it legitimately. However, we should do this with caution. The fact that the <code>Files</code> methods ignore the configured default encoding will not be changed by JEP 400.</p>
        
        
        
        <p>According to the <a rel="noreferrer noopener" href="https://openjdk.org:443/jeps/400#The-file-encoding-and-native-encoding-system-properties" target="_blank">documentation</a>, only the values "UTF-8" and "COMPAT" should be used anyway, with UTF-8 providing consistent encoding and COMPAT simulating pre-Java 18 behavior. All other values lead to unspecified behavior.</p>
        
        
        
        <p>Quite possibly, "file.encoding" will be deprecated in the future and later removed to eliminate the remaining potential source of errors (methods that respect the default encoding vs. those that do not).</p>
        
        
        
        <p>The best way is always to set "-Dfile.encoding" to UTF-8 or omit it altogether.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="Reading_the_Encodings_at_Runtime">Reading the Encodings at Runtime</span></h4>
        
        
        
        <p>The current default encoding can be read at runtime via <code>Charset.defaultCharset()</code> or the system property "file.encoding". Since <a href="/java/java-17-features/#System_Property_for_Native_Character_Encoding_Name">Java 17</a>, the system property "native.encoding" can be used to read the encoding, which – before Java 18 – would be the default encoding if none is specified:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-12" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">System.out.println(<span class="hljs-string">"Default charset : "</span> + Charset.defaultCharset());
        System.out.println(<span class="hljs-string">"file.encoding   : "</span> + System.getProperty(<span class="hljs-string">"file.encoding"</span>));
        System.out.println(<span class="hljs-string">"native.encoding : "</span> + System.getProperty(<span class="hljs-string">"native.encoding"</span>));</code></span><small class="shcb-language" id="shcb-language-12"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Without specifying <code>-Dfile.encoding</code>, the program prints the following on Linux and macOS with Java 17 and Java 18:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-13" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">Default charset : UTF-8
        file.encoding   : UTF-8
        native.encoding : UTF-8</code></span><small class="shcb-language" id="shcb-language-13"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>On Windows and Java 17, the output is as follows:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-14" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">Default charset : windows-1252
        file.encoding   : Cp1252
        native.encoding : Cp1252</code></span><small class="shcb-language" id="shcb-language-14"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>And on Windows and Java 18:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-15" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">Default charset : UTF-8
        file.encoding   : UTF-8
        native.encoding : Cp1252</code></span><small class="shcb-language" id="shcb-language-15"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>So the native encoding on Windows remains the same, but the default encoding changes to UTF-8 according to this JEP.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="The_Previous_Default_Character_Set">The Previous "Default" Character Set</span></h4>
        
        
        
        <p>If we run the little program from above on Linux or macOS and Java 17 with the <code>-Dfile.encoding=default</code> parameter, we get the following output:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-16" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">Default charset : US-ASCII
        file.encoding   : default
        native.encoding : UTF-8</code></span><small class="shcb-language" id="shcb-language-16"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>This is because the name "default" was previously recognized as an alias for the encoding "US-ASCII".</p>
        
        
        
        <p>In Java 18, this is changed: "default" is no longer recognized; the output looks like this:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-17" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">Default charset : UTF-8
        file.encoding   : default
        native.encoding : UTF-8</code></span><small class="shcb-language" id="shcb-language-17"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The system property "file.encoding" is still "default" – but at this point, we would also see any other invalid input. The default character set for an invalid "file.encoding" input is always UTF-8 as of Java 18 or corresponds to the native encoding up to Java 17.</p>
        
        
        
        <h3 class="wp-block-heading" id="charset-forname-taking-fallback-default-value"><span id="CharsetforName_Taking_Fallback_Default_Value"><span id="CharsetforName_Taking_Fallback_Default_Value">Charset.forName() Taking Fallback Default Value</span></span></h3>
        
        
        
        <p>Not part of the above JEP and not defined in any other JEP is the new method <code>Charset.forName(String charsetName, Charset fallback)</code>. This method returns the specified fallback value instead of throwing an <code>IllegalCharsetNameException</code> or an <code>UnsupportedCharsetException</code> if the character set name is unknown or the character set is not supported.</p>
        
        
        
        <h2 class="wp-block-heading" id="simple-web-server"><span id="Simple_Web_Server"><span id="Simple_Web_Server">Simple Web Server</span></span></h2>
        
        
        
        <p>Almost all modern programming languages allow starting up a rudimentary HTTP server to, for example, quickly test some web functionality.</p>
        
        
        
        <p>Through <a rel="noopener" href="https://openjdk.org:443/jeps/408" target="_blank">JDK Enhancement Proposal 408</a>, Java also offers this possibility as of version 18.</p>
        
        
        
        <p>The easiest way to start the provided webserver is the <code>jwebserver</code> command. It starts the server on localhost:8000 and provides a file browser for the current directory:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-18" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">$ jwebserver
        Binding to loopback by default. For all interfaces use "-b 0.0.0.0" or "-b ::".
        Serving /home/sven and subdirectories on 127.0.0.1 port 8000
        URL http://127.0.0.1:8000/</code></span><small class="shcb-language" id="shcb-language-18"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>As shown, you can use the <code>-b</code> parameter to specify the IP address on which the server should listen. With <code>-p</code>, you can change the port and with <code>-d</code> the directory the server should serve. With -o, you can configure the log output. For example:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-19" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">$ jwebserver -b 127.0.0.100 -p 4444 -d /tmp -o verbose
        Serving /tmp and subdirectories on 127.0.0.100 port 4444
        URL http://127.0.0.100:4444/</code></span><small class="shcb-language" id="shcb-language-19"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>You get a list of options with explanations with <code>jwebserver -h</code>.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="Web_Server_Features">Web Server Features</span></h4>
        
        
        
        <p>The web server is very rudimentary and has the following limitations:</p>
        
        
        
        <ul>
        <li>The only supported protocol is HTTP/1.1.</li>
        
        
        
        <li>HTTPS is not provided.</li>
        
        
        
        <li>Only the HTTP GET and HEAD methods are allowed.</li>
        </ul>
        
        
        
        <h4 class="wp-block-heading"><span id="Java_API_SimpleFileServer">Java API: SimpleFileServer</span></h4>
        
        
        
        <p><code>jwebserver</code> is not a standalone tool, but just a wrapper that calls:</p>
        
        
        
        <p class="has-text-align-center"><code>java -m jdk.httpserver</code></p>
        
        
        
        <p>This command calls the <code>main()</code> method of the <code>sun.net.httpserver.simpleserver.Main</code> class of the <code>jdk.httpserver</code> module, which, in turn, calls <code>SimpleFileServerImpl.start(…)</code>. This starter evaluates the command line parameters and finally creates the server via <code>SimpleFileServer.createFileServer(…)</code>.</p>
        
        
        
        <p>With this method, you can also start a server via Java code:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-20" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">HttpServer server =
            SimpleFileServer.createFileServer(
                <span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>), Path.of(<span class="hljs-string">"\tmp"</span>), OutputLevel.INFO);
        server.start();</code></span><small class="shcb-language" id="shcb-language-20"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Using the Java API, you can extend the web server. You can, for example, make specific directories of the file system accessible via different HTTP paths, and you can extend the server with your own handlers for certain paths and HTTP methods (e.g., PUT).</p>
        
        
        
        <p>A complete tutorial is beyond the scope of this article. See the <a rel="noopener" href="https://openjdk.org:443/jeps/408#API" target="_blank">"API" and "Enhanced request handling" sections in the JEP</a> for more details.</p>
        
        
        
        <h2 class="wp-block-heading" id="code-snippets-in-java-api-documentation"><span id="Code_Snippets_in_Java_API_Documentation"><span id="Code_Snippets_in_Java_API_Documentation">Code Snippets in Java API Documentation</span></span></h2>
        
        
        
        <p>Until now, if we wanted to integrate multiline code snippets into JavaDoc, we had to do this quite cumbersomely via <code>&lt;pre&gt;…&lt;/pre&gt;</code> – optionally in combination with <code>{@code … }</code>. For this, we had to pay attention to two things:</p>
        
        
        
        <ol>
        <li>There must be no line breaks between <code>&lt;pre&gt;</code> and the code and between the code and <code>&lt;/pre&gt;</code>.</li>
        
        
        
        <li>The code starts directly after the asterisks; i.e., if there are spaces between the asterisks and the code, they also appear in the JavaDoc. So the code must be shifted one character to the left compared to the rest of the text in the JavaDoc comment.</li>
        </ol>
        
        
        
        <p>Here is an example with <code>&lt;pre&gt;</code>:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-21" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">/**
         * How to write a text file with Java 7:
         *
         * &lt;pre&gt;&lt;b&gt;try&lt;/b&gt; (BufferedWriter writer = Files.&lt;i&gt;newBufferedWriter&lt;/i&gt;(path)) {
         *  writer.write(text);
         *}&lt;/pre&gt;
         */</span></code></span><small class="shcb-language" id="shcb-language-21"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>And one with <code>&lt;pre&gt;</code> and <code>{@code … }</code>:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-22" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">/**
         * How to write a text file with Java 7:
         *
         * &lt;pre&gt;{<span class="hljs-doctag">@code</span> try (BufferedWriter writer = Files.newBufferedWriter(path)) {
         *  writer.write(text);
         *}}&lt;/pre&gt;
         */</span></code></span><small class="shcb-language" id="shcb-language-22"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The difference between the two variants is that in the first variant, we can format the code with HTML tags such as <code>&lt;b&gt;</code> and <code>&lt;i&gt;</code>, while in the second variant, such tags would not be evaluated but displayed.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="The_snippet_Tag_in_Java_18">The @snippet Tag in Java 18</span></h4>
        
        
        
        <p><a rel="noopener" href="https://openjdk.org:443/jeps/413" target="_blank">JDK Enhancement Proposal 413</a> enhances the JavaDoc syntax with the <code>@snippet</code> tag, specifically designed to display source code. With the <code>@snippet</code> tag, we can write the comment as follows:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-23" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">/**
         * How to write a text file with Java 7:
         *
         * {<span class="hljs-doctag">@snippet</span> :
         * try (BufferedWriter writer = Files.newBufferedWriter(path)) {
         *   writer.write(text);
         * }
         * }
         */</span></code></span><small class="shcb-language" id="shcb-language-23"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>We can also highlight parts of the code using <code>@highlight</code> – for example, all occurrences of "text" within the second line of code:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-24" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">/**
         * {<span class="hljs-doctag">@snippet</span> :
         * try (BufferedWriter writer = Files.newBufferedWriter(path)) {
         *   writer.write(text);  // <span class="hljs-doctag">@highlight</span> substring="text"
         * }
         * }
         */</span></code></span><small class="shcb-language" id="shcb-language-24"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The following example highlights all words starting with "write" within the block marked with <code>@highlight region</code> and <code>@end</code>. With <code>type="…"</code>, we can also specify the type of highlighting: <code>bold</code>, <code>italic</code>, or <code>highlighted</code> (with a colored background).</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-25" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">/**
         * {<span class="hljs-doctag">@snippet</span> :
         * // <span class="hljs-doctag">@highlight</span> region regex="\bwrite.*?\b" type="highlighted"
         * try (BufferedWriter writer = Files.newBufferedWriter(path)) {
         *   writer.write(text);                                          
         * }
         * // <span class="hljs-doctag">@end</span>
         * }
         */</span></code></span><small class="shcb-language" id="shcb-language-25"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>With <code>@link</code>, we can link a part of the text, e.g., <code>BufferedWriter</code>, to its JavaDoc:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-26" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">/**
         * {<span class="hljs-doctag">@snippet</span> :
         * // <span class="hljs-doctag">@link</span> substring="BufferedWriter" target="java.io.BufferedWriter" :
         * try (BufferedWriter writer = Files.newBufferedWriter(path)) {
         *   writer.write(text);
         * }
         * }
         */</span></code></span><small class="shcb-language" id="shcb-language-26"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Attention: the colon at the end of the line with the <code>@link</code> tag is essential in this case, and it means that the comment refers to the following line. We could also write the comment at the end of the next line, just like in the first <code>@highlight</code> example – or use <code>@link region</code> and <code>@end</code> to specify a part within which all occurrences of <code>BufferedWriter</code> should be linked.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="Integrate_Snippets_from_Other_Files">Integrate Snippets from Other Files</span></h4>
        
        
        
        <p>According to JEP, it should also be possible to refer to marked code in another file:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-27" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">/**
         * How to write a text file with Java 7:
         *
         * {<span class="hljs-doctag">@snippet</span> file="FileWriter.java" region="writeFile"}
         */</span></code></span><small class="shcb-language" id="shcb-language-27"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>In the <code>FileWriter.java</code> file, we would mark the code as follows:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-28" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-comment">// @start region="writeFile"</span>
        <span class="hljs-keyword">try</span> (BufferedWriter writer = Files.newBufferedWriter(path)) {
          writer.write(text);
        }
        <span class="hljs-comment">// @end</span></code></span><small class="shcb-language" id="shcb-language-28"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>However, this variant leads to a "File not found" error message when calling the <code>javadoc</code> command of the current early-access release (build 18-ea+29-2007). This JEP is apparently not yet fully implemented at this time.</p>
        
        
        
        <p>These were the most important <code>@snippet</code> tags, in my opinion. You can find a complete reference in the <a rel="noopener" href="https://openjdk.org:443/jeps/413#Snippet-tag-reference" target="_blank">JEP</a>. </p>
        
        
        
        <h2 class="wp-block-heading" id="internet-address-resolution-spi"><span id="Internet-Address_Resolution_SPI"><span id="Internet-Address_Resolution_SPI">Internet-Address Resolution SPI</span></span></h2>
        
        
        
        <p>To find out the IP address(es) for a hostname in Java, we can use <code>InetAddress.getByName(…)</code> or <code>InetAddress.getAllByName(…)</code>. Here is an example:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-29" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">InetAddress[] addresses = InetAddress.getAllByName(<span class="hljs-string">"www.happycoders.eu"</span>);
        System.out.println(<span class="hljs-string">"addresses = "</span> + Arrays.toString(addresses));</code></span><small class="shcb-language" id="shcb-language-29"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The code gives me the following output (I added the line breaks manually for better readability):</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-30" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">addresses = [www.happycoders.eu/104.26.15.71,
                     www.happycoders.eu/172.67.71.232, 
                     www.happycoders.eu/104.26.14.71]</code></span><small class="shcb-language" id="shcb-language-30"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>For reverse lookups (i.e., resolving an IP address to a hostname), the JDK provides the methods <code>InetAddress::getCanonicalHostName</code> and <code>InetAddress::getHostName</code>.</p>
        
        
        
        <p>By default, <code>InetAddress</code> uses the operating system's resolver, i.e., it usually consults the hosts file and the configured DNS servers.</p>
        
        
        
        <p>This hardwiring has a few disadvantages:</p>
        
        
        
        <ul>
        <li>Within tests, it is not possible to map a hostname to the URL of a mocked server.</li>
        
        
        
        <li>New hostname lookup protocols (such as DNS over QUIC, TLS, or HTTPS) cannot be easily implemented in Java.</li>
        
        
        
        <li>The current implementation leads to a blocking operating system call. That alone is unattractive since this call can sometimes take long and cannot be interrupted. When using <a href="/java/virtual-threads/">virtual threads</a>, this even leads to the point that the operating system thread cannot serve any other virtual threads during this time.</li>
        </ul>
        
        
        
        <p><a rel="noopener" href="https://openjdk.org:443/jeps/418" target="_blank">JDK Enhancement Proposal 418</a> introduces a Service Provider Interface (SPI) to allow the platform's built-in default resolver to be replaced by other resolvers.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="Internet-Address_Resolution_SPI_JEP_418_-_Example">Internet-Address Resolution SPI / JEP 418 – Example</span></h4>
        
        
        
        <p>The following example shows how to implement and register a simple resolver that responds to every request with the IP address 127.0.0.1. You can also find the code in this <a rel="noopener" href="https://github.com/SvenWoltmann/internet-address-resolution-spi-jep-418-demo" target="_blank">GitHub repository</a>.</p>
        
        
        
        <p>We first write the resolver by implementing the <code>java.net.spi.InetAddressResolver.InetAddressResolver</code> interface introduced in Java 18 (class <a rel="noopener" href="https://github.com/SvenWoltmann/internet-address-resolution-spi-jep-418-demo/blob/main/src/eu/happycoders/jep418/HappyCodersInetAddressResolver.java" target="_blank">HappyCodersInetAddressResolver in GitHub</a>):</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-31" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HappyCodersInetAddressResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InetAddressResolver</span> </span>{
          <span class="hljs-meta">@Override</span>
          <span class="hljs-function"><span class="hljs-keyword">public</span> Stream&lt;InetAddress&gt; <span class="hljs-title">lookupByName</span><span class="hljs-params">(String host, LookupPolicy lookupPolicy)</span>
              <span class="hljs-keyword">throws</span> UnknownHostException </span>{
            <span class="hljs-keyword">return</span> Stream.of(InetAddress.getByAddress(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[] {<span class="hljs-number">127</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>}));
          }
        
          <span class="hljs-meta">@Override</span>
          <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">lookupByAddress</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] addr)</span> </span>{
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();
          }
        }</code></span><small class="shcb-language" id="shcb-language-31"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Since I only want to present the basic principle here, I kept the resolver as simple as possible, and it does not support reverse lookups.</p>
        
        
        
        <p>Second, we need a resolver provider (class <a rel="noopener" href="https://github.com/SvenWoltmann/internet-address-resolution-spi-jep-418-demo/blob/main/src/eu/happycoders/jep418/HappyCodersInetAddressResolverProvider.java" target="_blank">HappyCodersInetAddressResolverProvider in GitHub</a>):</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-32" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HappyCodersInetAddressResolverProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">InetAddressResolverProvider</span> </span>{
          <span class="hljs-meta">@Override</span>
          <span class="hljs-function"><span class="hljs-keyword">public</span> InetAddressResolver <span class="hljs-title">get</span><span class="hljs-params">(Configuration configuration)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HappyCodersInetAddressResolver();
          }
        
          <span class="hljs-meta">@Override</span>
          <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">name</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"HappyCoders Internet Address Resolver Provider"</span>;
          }
        }</code></span><small class="shcb-language" id="shcb-language-32"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The provider creates a new instance of the previously implemented resolver in the <code>get()</code> method.</p>
        
        
        
        <p>In the third step, we have to register the resolver. To do this, we create a file in the <code>META-INF/services</code> directory with the name <code>java.net.spi.InetAddressResolverProvider</code> and the following content (<a href="https://github.com/SvenWoltmann/internet-address-resolution-spi-jep-418-demo/blob/main/src/META-INF/services/java.net.spi.InetAddressResolverProvider" target="_blank" rel="noopener">file in GitHub</a>):</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-33" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">eu.happycoders.jep416.HappyCodersInetAddressResolverProvider</code></span><small class="shcb-language" id="shcb-language-33"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Now we run the code from above again (class <a rel="noopener" href="https://github.com/SvenWoltmann/internet-address-resolution-spi-jep-418-demo/blob/main/src/eu/happycoders/jep418/Jep418Demo.java" target="_blank">Jep418Demo in GitHub</a>):</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-34" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">InetAddress[] addresses = InetAddress.getAllByName(<span class="hljs-string">"www.happycoders.eu"</span>);
        System.out.println(<span class="hljs-string">"addresses = "</span> + Arrays.toString(addresses));</code></span><small class="shcb-language" id="shcb-language-34"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The output now reads:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-35" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">addresses = [/127.0.0.1]</code></span><small class="shcb-language" id="shcb-language-35"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>That is precisely the IP address we returned in our resolver.</p>
        
        
        
        <h2 class="wp-block-heading" id="preview-and-incubator-features"><span id="Preview_and_Incubator-Features"><span id="Preview_and_Incubator-Features">Preview and Incubator-Features</span></span></h2>
        
        
        
        <p>In the following sections, you will find preview and incubator features that we already know from previous releases. They are resubmissions with minor changes.</p>
        
        
        
        <h3 class="wp-block-heading" id="pattern-matching-for-switch-second-preview"><span id="Pattern_Matching_for_switch_Second_Preview"><span id="Pattern_Matching_for_switch_Second_Preview">Pattern Matching for switch (Second Preview)</span></span></h3>
        
        
        
        <p>"Pattern Matching for switch" was first introduced in <a href="/java/java-17-features/#Pattern_Matching_for_switch_Preview">Java 17</a> and enables <code>switch</code> statements (and expressions) such as the following (for more, see the linked Java 17 article):</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-36" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java"><span class="hljs-keyword">switch</span> (obj) {
          <span class="hljs-keyword">case</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span> -&gt; System.out.println(s.toUpperCase());
          <span class="hljs-keyword">case</span> String s                   -&gt; System.out.println(s.toLowerCase());
        
          <span class="hljs-keyword">case</span> Integer i                  -&gt; System.out.println(i * i);
        
          <span class="hljs-keyword">default</span> -&gt; {}
        }</code></span><small class="shcb-language" id="shcb-language-36"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p><a rel="noopener" href="https://openjdk.org:443/jeps/420" target="_blank">JDK Enhancement Proposal 420</a> introduced two changes in Java 18 – one in dominance checking and one related to exhaustiveness analysis in combination with sealed types.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="Improvement_of_the_Dominance_Test">Improvement of the Dominance Test</span></h4>
        
        
        
        <p>I described what dominance checking is in the Java 17 article linked above. In a nutshell: the following code leads to a compiler error:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-37" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>Object obj = ...
        </span></span><span class="shcb-loc"><span><span class="hljs-keyword">switch</span> (obj) {
        </span></span><span class="shcb-loc"><span>  <span class="hljs-keyword">case</span> String s                   -&gt; System.out.println(s.toLowerCase());
        </span></span><span class="shcb-loc"><span>  <span class="hljs-keyword">case</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span> -&gt; System.out.println(s.toUpperCase());
        </span></span><span class="shcb-loc"><span>  ...
        </span></span><span class="shcb-loc"><span>}
        </span></span></code></span><small class="shcb-language" id="shcb-language-37"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The reason is that the pattern in line 3 "dominates" the longer pattern from line 4: If <code>obj</code> is a <code>String</code>, it is matched by the pattern in line 3, no matter how long it is. So no object is ever matched by the pattern in line 4.</p>
        
        
        
        <p>However, one case has not been considered so far – namely, the combination of a constant and a guarded pattern (a pattern with <code>&amp;&amp;</code>). So the following code is allowed in Java 17:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-38" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>String string = ...
        </span></span><span class="shcb-loc"><span><span class="hljs-keyword">switch</span> (string) {
        </span></span><span class="shcb-loc"><span>  <span class="hljs-keyword">case</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span> -&gt; System.out.println(s.toUpperCase());
        </span></span><span class="shcb-loc"><span>  <span class="hljs-keyword">case</span> <span class="hljs-string">"foobar"</span>                   -&gt; System.out.println(<span class="hljs-string">"baz"</span>);
        </span></span><span class="shcb-loc"><span>  ...
        </span></span><span class="shcb-loc"><span>}
        </span></span></code></span><small class="shcb-language" id="shcb-language-38"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>However, if <code>obj</code> is equal to "foobar", it is not matched by line 4 but already by line 3 (because it is also longer than five characters).</p>
        
        
        
        <p>Since unreachable code is obviously not intended, we get the following compiler error in Java 18:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-39" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">java --enable-preview --source 18 SwitchTest.java
        SwitchTest.java:9: error: this case label is dominated by a preceding case label
              case "foobar"                   -&gt; System.out.println("baz");
                   ^</code></span><small class="shcb-language" id="shcb-language-39"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <h4 class="wp-block-heading"><span id="Bugfix_in_the_Exhaustiveness_Analysis_with_Sealed_Types">Bugfix in the Exhaustiveness Analysis with Sealed Types</span></h4>
        
        
        
        <p>You will learn what exhaustiveness analysis is in the <a href="/java/sealed-classes/#Completeness_Analysis_for_Pattern_Matching_for_switch">article about sealed types</a>.</p>
        
        
        
        <p>I explain the change in Java 18 using the following sealed example class hierarchy from the JEP:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-40" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">sealed <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">I</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">permits</span> <span class="hljs-title">A</span>, <span class="hljs-title">B</span> </span>{}
        <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span>&lt;<span class="hljs-title">X</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">I</span>&lt;<span class="hljs-title">String</span>&gt; </span>{}
        <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span>&lt;<span class="hljs-title">Y</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">I</span>&lt;<span class="hljs-title">Y</span>&gt; </span>{}</code></span><small class="shcb-language" id="shcb-language-40"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>The following code is not compilable:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-41" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">I&lt;Integer&gt; i = ...
        <span class="hljs-keyword">switch</span> (i) {
          <span class="hljs-keyword">case</span> A&lt;Integer&gt; a -&gt; System.out.println(<span class="hljs-string">"It's an A"</span>);  <span class="hljs-comment">// not compilable</span>
          <span class="hljs-keyword">case</span> B&lt;Integer&gt; b -&gt; System.out.println(<span class="hljs-string">"It's a B"</span>);
        }</code></span><small class="shcb-language" id="shcb-language-41"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Both Java 17 and Java 18 recognize that <code>I&lt;Integer&gt;</code> cannot be converted to <code>A&lt;Integer&gt;</code> (since <code>A&lt;Integer&gt;</code> is an <code>I&lt;String&gt;</code>) and report:</p>
        
        
        
        <p class="has-text-align-center"><code>incompatible types: I&lt;Integer&gt; cannot be converted to A&lt;Integer&gt;</code></p>
        
        
        
        <p>In fact, because of the sealed class hierarchy, <code>B&lt;Integer&gt;</code> is the only class that can implement <code>I&lt;Integer&gt;</code>. Thus, the switch statement is complete as follows:</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-42" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">I&lt;Integer&gt; i = ...
        <span class="hljs-keyword">switch</span> (i) {
          <span class="hljs-keyword">case</span> B&lt;Integer&gt; b -&gt; System.out.println(<span class="hljs-string">"It's a B"</span>);
        }</code></span><small class="shcb-language" id="shcb-language-42"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>Java 17 reports here, however:</p>
        
        
        
        <p class="has-text-align-center"><code>the switch statement does not cover all possible input values</code></p>
        
        
        
        <p>That is an obvious bug that has been fixed in Java 18.</p>
        
        
        
        <h3 class="wp-block-heading" id="vector-api-third-incubator"><span id="Vector_API_Third_Incubator"><span id="Vector_API_Third_Incubator">Vector API (Third Incubator)</span></span></h3>
        
        
        
        <p>The Vector API was already introduced in <a href="/java/java-16-features/#Vector_API_Incubator">Java 16</a> and <a href="/java/java-17-features/#Vector_API_Second_Incubator">Java 17</a> as an Incubator feature. This API is not about the <code>java.util.Vector</code> class from Java 1.0 but about mathematical vector computation and its mapping to modern single-instruction-multiple-data (SIMD) architectures.</p>
        
        
        
        <p><a rel="noopener" href="https://openjdk.org:443/jeps/417" target="_blank">JDK Enhancement Proposal 417</a> has again improved performance and extended support to "ARM Scalable Vector Extension" – an optional extension to the ARM64 platform.</p>
        
        
        
        <p>The incubator stage means that the feature can still go through significant changes. I will present the Vector API in more detail once it reaches preview status.</p>
        
        
        
        <h3 class="wp-block-heading" id="foreign-function-memory-api-second-incubator"><span id="Foreign_Function_Memory_API_Second_Incubator"><span id="Foreign_Function_Memory_API_Second_Incubator">Foreign Function &amp; Memory API (Second Incubator)</span></span></h3>
        
        
        
        <p>The Foreign Function &amp; Memory API was created in <a href="/java/java-16-features/#Foreign_Linker_API_Incubator_Foreign-Memory_Access_API_Third_Incubator">Java 17</a> by combining the "Foreign Memory Access API" and the "Foreign Linker API", both of which previously went through several incubator phases.</p>
        
        
        
        <p>The new API is being developed within <a rel="noopener" href="https://openjdk.org:443/projects/panama/" target="_blank">Project Panama</a> and is intended to replace JNI (Java Native Interface), which has already been part of the platform since Java 1.1. JNI allows C code to be called from Java. Anyone who has worked with JNI knows: JNI is highly complicated to implement, error-prone, and slow.</p>
        
        
        
        <p>The goal of the new API is to reduce implementation effort by 90% and accelerate API performance by a factor of 4 to 5.</p>
        
        
        
        <p><a rel="noopener" href="https://openjdk.org:443/jeps/419" target="_blank">JDK Enhancement Proposal 419</a> has made extensive changes to the API. In the next release, <a href="/java/java-19-features/#Foreign_Function_Memory_API_Preview">Java 19</a>, the API will reach the preview stage.</p>
        
        
        
        <h2 class="wp-block-heading" id="deprecations-and-deletions"><span id="Deprecations_and_Deletions"><span id="Deprecations_and_Deletions">Deprecations and Deletions</span></span></h2>
        
        
        
        <p>Again in Java 18, some features have been marked as "deprecated for removal" or deleted.</p>
        
        
        
        <h3 class="wp-block-heading" id="deprecate-finalization-for-removal"><span id="Deprecate_Finalization_for_Removal"><span id="Deprecate_Finalization_for_Removal">Deprecate Finalization for Removal</span></span></h3>
        
        
        
        <p>Finalization has existed since Java 1.0 and is intended to help avoid resource leaks by allowing classes to implement a <code>finalize()</code> method to release system resources (such as file handles or non-heap memory) requested by the operating system.</p>
        
        
        
        <p>The garbage collector calls the <code>finalize()</code> method before releasing an object's memory.</p>
        
        
        
        <p>That seems to be a reasonable solution. However, it has been shown that finalization has some fundamental, critical flaws:</p>
        
        
        
        <p>Performance:</p>
        
        
        
        <ul>
        <li>It is unpredictable when the garbage collector will clean up an object (and whether it will do so at all). Therefore, it may happen that – after an object is no longer referenced – it takes a very long time for its <code>finalize()</code> method to be called (or that it is never called).</li>
        
        
        
        <li>When the garbage collector performs a full GC, there can be noticeable latency if many of the objects being cleaned up have <code>finalize()</code> methods.</li>
        
        
        
        <li>The <code>finalize()</code> method is called for <em>every</em> instance of a class, even if it is not necessary. There is no way to specify that individual objects do not need finalization.</li>
        </ul>
        
        
        
        <p>Security risks:</p>
        
        
        
        <ul>
        <li>The <code>finalize()</code> method can execute arbitrary code, e.g., storing a reference of the object to be deleted. Thus, the garbage collector will not clean it up. If the reference to the object is later removed and the garbage collector deletes the object, its <code>finalize()</code> method is not called again.</li>
        
        
        
        <li>When the constructor of a class throws an exception, the object resides on the heap. When the garbage collector later removes it, it calls its <code>finalize()</code> method, which can then perform operations on a possibly incompletely initialized object or even store it in the object graph.</li>
        </ul>
        
        
        
        <p>Error-proneness:</p>
        
        
        
        <ul>
        <li>A <code>finalize()</code> method should always call the <code>finalize()</code> method of the parent class as well. However, the compiler does not enforce this (as it does with the constructor). Even if we write our code without errors, someone else could extend our class, override the <code>finalize()</code> method without calling the overridden method, and thereby cause a resource leak.</li>
        </ul>
        
        
        
        <p>Multithreading:</p>
        
        
        
        <ul>
        <li><span style="color: initial;">The <code>finalize()</code> method is called in an unspecified thread, so thread safety of the entire object must be maintained – even in an application that does not use multithreading.</span></li>
        </ul>
        
        
        
        <h4 class="wp-block-heading"><span id="Alternatives_to_Finalization">Alternatives to Finalization</span></h4>
        
        
        
        <p>The following alternatives to finalization exist:</p>
        
        
        
        <ul>
        <li>The "try-with-resources" introduced in Java 7 automatically generates a <code>finally</code> block for all classes that implement the <code>AutoCloseable</code> interface, in which the corresponding <code>close()</code> methods are called. Typical static code analysis tools find and complain about code that does not generate <code>AutoCloseable</code> objects inside "try-with-resources" blocks.</li>
        
        
        
        <li>Through the <a rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html" target="_blank">Cleaner API</a> introduced in Java 9, so-called "Cleaner Actions" can be registered. The garbage collector invokes them when an object is no longer accessible (not only when it reclaims its memory). Cleaner actions do not have access to the object itself (so they cannot store a reference to it); we only need to register them for an object when that specific object needs them; and we can determine in which thread they are called.</li>
        </ul>
        
        
        
        <p>For the above reasons and the availability of sufficient alternatives, the <code>finalize()</code> methods in Object and numerous other classes of the JDK class library were already marked as "deprecated" in Java 9.</p>
        
        
        
        <p><a rel="noopener" href="https://openjdk.org:443/jeps/421" target="_blank">JDK Enhancement Proposal 421</a> marks the methods in Java 18 as "deprecated for removal".</p>
        
        
        
        <p>Furthermore, the VM option <code>--finalization=disabled</code> is introduced, which completely disables finalization. This allows us to test applications before migrating them to a future Java version where finalization has been removed.</p>
        
        
        
        <h4 class="wp-block-heading"><span id="JDK_Flight_Recorder_Event_for_Finalization">JDK Flight Recorder Event for Finalization</span></h4>
        
        
        
        <p>Not part of the above JEP is the new Flight Recorder event "jdk.FinalizerStatistics". It is enabled by default and logs every instantiated class with a non-empty <code>finalize()</code> method. That makes it easy to identify those classes that still use a finalizer.</p>
        
        
        
        <p>These events are not triggered when finalization is disabled via <code>--finalization=disabled</code>.</p>
        
        
        
        <h3 class="wp-block-heading" id="terminally-deprecate-thread-stop"><span id="Terminally_Deprecate_Threadstop"><span id="Terminally_Deprecate_Threadstop">Terminally Deprecate Thread.stop</span></span></h3>
        
        
        
        <p><code>Thread.stop()</code> is marked as "deprecated for removal" in Java 18 – finally, after being "deprecated" since Java 1.2. Hopefully, it will be deleted in one of the following releases – together with <code>suspend()</code> and <code>resume()</code> and the corresponding <code>ThreadGroup</code> methods.</p>
        
        
        
        <p><em>(There is no JDK enhancement proposal for this change.)</em></p>
        
        
        
        <h3 class="wp-block-heading" id="remove-the-legacy-plainsocketimpl-and-plaindatagramsocketimpl-implementation"><span id="Remove_the_Legacy_PlainSocketImpl_and_PlainDatagramSocketImpl_Implementation"><span id="Remove_the_Legacy_PlainSocketImpl_and_PlainDatagramSocketImpl_Implementation">Remove the Legacy PlainSocketImpl and PlainDatagramSocketImpl Implementation</span></span></h3>
        
        
        
        <p>In <a href="/java/java-13-features/">Java 13</a> and <a href="/java/java-15-features/">Java 15</a>, the JDK developers reimplemented the Socket API and the DatagramSocket API.</p>
        
        
        
        <p>The old implementations could since be reactivated via the <code>jdk.net.usePlainSocketImpl</code> or <code>jdk.net.usePlainDatagramSocketImpl</code> system properties.</p>
        
        
        
        <p>In Java 18, the old code was removed, and the above system properties were removed.</p>
        
        
        
        <p><em>(There is no JDK enhancement proposal for this change.)</em></p>
        
        
        
        <h2 class="wp-block-heading" id="other-changes-in-java-18"><span id="Other_Changes_in_Java_18"><span id="Other_Changes_in_Java_18">Other Changes in Java 18</span></span></h2>
        
        
        
        <p>In this section, you will find those changes that you will rarely encounter during your daily programming work. Nevertheless, it certainly does not hurt to skim them once.</p>
        
        
        
        <h3 class="wp-block-heading" id="reimplement-core-reflection-with-method-handles"><span id="Reimplement_Core_Reflection_with_Method_Handles"><span id="Reimplement_Core_Reflection_with_Method_Handles">Reimplement Core Reflection with Method Handles</span></span></h3>
        
        
        
        <p>If you have a lot to do with Java reflection, you will know that there is always more than one way to go. For example, to read the private <code>value</code> field of a String via reflection, there are two ways:</p>
        
        
        
        <p>1. Per so-called "core reflection":</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-43" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">Field field = String<span class="hljs-class">.<span class="hljs-keyword">class</span>.<span class="hljs-title">getDeclaredField</span>("<span class="hljs-title">value</span>")</span>;
        field.setAccessible(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">byte</span>[] value = (<span class="hljs-keyword">byte</span>[]) field.get(string);</code></span><small class="shcb-language" id="shcb-language-43"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>2. Via "method handles":</p>
        
        
        <pre class="wp-block-code" aria-describedby="shcb-language-44" data-shcb-language-name="Java" data-shcb-language-slug="java"><span><code class="hljs language-java">VarHandle handle =
            MethodHandles.privateLookupIn(String<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">MethodHandles</span>.<span class="hljs-title">lookup</span>())
                .<span class="hljs-title">findVarHandle</span>(<span class="hljs-title">String</span>.<span class="hljs-title">class</span>, "<span class="hljs-title">value</span>", <span class="hljs-title">byte</span>[].<span class="hljs-title">class</span>)</span>;
        <span class="hljs-keyword">byte</span>[] value = (<span class="hljs-keyword">byte</span>[]) handle.get(string);</code></span><small class="shcb-language" id="shcb-language-44"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">Java</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">java</span><span class="shcb-language__paren">)</span></small></pre>
        
        
        <p>(Important: Since Java 16, for both variants, you have to open the package <code>java.lang</code> from the module <code>java.base</code> for the calling module, e.g., via VM option <code>--add-opens java.base/java.lang=ALL-UNNAMED</code>).</p>
        
        
        
        <p>There is a third form that we can't see directly: core reflection uses additional native JVM methods for the first few calls after starting the JVM and only starts compiling and optimizing the Java reflection bytecode after a while.</p>
        
        
        
        <p>Maintaining all three variants means a considerable effort for the JDK developers. Therefore, as part of <a rel="noopener" href="https://openjdk.org:443/jeps/416" target="_blank">JDK Enhancement Proposal 416</a>, it was decided to reimplement the code of the reflection classes <code>java.lang.reflect.Method</code>, <code>Field</code>, and <code>Constructor</code> using method handles and thus reduce the development effort.</p>
        
        
        
        <h3 class="wp-block-heading" id="zgc-serialgc-parallelgc-support-string-deduplication"><span id="ZGC_SerialGC_ParallelGC_Support_String_Deduplication"><span id="ZGC_SerialGC_ParallelGC_Support_String_Deduplication">ZGC / SerialGC / ParallelGC Support String Deduplication</span></span></h3>
        
        
        
        <p>Since Java 18, the Z garbage collector, which was released as production-ready in <a href="/java/java-15-features/#ZGC_A_Scalable_Low-Latency_Garbage_Collector">Java 15</a>, and the serial and parallel garbage collectors also support string deduplication.</p>
        
        
        
        <p>String deduplication means that the garbage collector detects strings whose <code>value</code> and <code>coder</code> fields contain the same bytes. The GC deletes all but one of these byte arrays and lets all string instances reference this single byte array.</p>
        
        
        
        <p>Remember, it is not actually the Strings that are deduplicated (as the name of the feature implies), but only their byte arrays. Nothing changes in the identities of the String objects themselves.</p>
        
        
        
        <p>String deduplication is disabled by default (as it is a potential attack vector via <a href="/java/deep-reflection-how-to-hack-integer-and-string/">deep reflection</a>) and must be explicitly enabled via VM option <code>-XX:+UseStringDeduplication</code>.</p>
        
        
        
        <p><em>(String deduplication was first released with <a rel="noopener" href="https://openjdk.org:443/jeps/192" target="_blank">JDK Enhancement Proposal 192</a> in Java 8u20 for G1. There is no separate JEP for inclusion in the ZGC, serial GC, and parallel GC in Java 18).</em></p>
        
        
        
        <h3 class="wp-block-heading" id="allow-g1-heap-regions-up-to-512-mb"><span id="Allow_G1_Heap_Regions_up_to_512_MB"><span id="Allow_G1_Heap_Regions_up_to_512_MB">Allow G1 Heap Regions up to 512 MB</span></span></h3>
        
        
        
        <p>The G1 Garbage Collector usually determines the size of the heap regions automatically. Depending on the heap size, the size of the regions is set to a value between 1 MB and 32 MB.</p>
        
        
        
        <p>You can also set the region size manually via VM option <code>-XX:G1HeapRegionSize</code>. Sizes between 1 MB and 32 MB were previously allowed here as well.</p>
        
        
        
        <p>In Java 18, the maximum size of regions is increased to 512 MB. This is particularly intended to help reduce heap fragmentation for very large objects.</p>
        
        
        
        <p>The change only applies to the manual setting of the region size. When determined automatically by the JVM (i.e., without specifying the VM option), the maximum size remains 32 GB.</p>
        
        
        
        <p><em>(There is no JDK enhancement proposal for this change.)</em></p>
        
        
        
        <h3 class="wp-block-heading" id="complete-list-of-all-changes-in-java-18"><span id="Complete_List_of_All_Changes_in_Java_18"><span id="Complete_List_of_All_Changes_in_Java_18">Complete List of All Changes in Java 18</span></span></h3>
        
        
        
        <p>In addition to the JDK Enhancement Proposals and changes to the class libraries presented in this article, there are other changes (e.g., to the cryptography modules) beyond this article's scope. You can find a complete list in the <a href="https://www.oracle.com/java/technologies/javase/18all-relnotes.html" target="_blank" rel="noreferrer noopener">JDK 18 release notes</a>.</p>
        
        
        
        <h2 class="wp-block-heading" id="summary"><span id="Summary"><span id="Summary">Summary</span></span></h2>
        
        
        
        <p>Java 18 marks the beginning of the next cycle of non-LTS releases – until the next LTS version, <a href="/java/java-21-features/">Java 21</a>, will be released in September 2023. If you have done the math, you will notice that there were five non-LTS releases and three years between Java 11 and Java 17 – but there will only be three non-LTS releases and two years between Java 17 and 21. Shortly before the release of Java 17, <a rel="noopener" href="https://blogs.oracle.com/javamagazine/post/java-long-term-support-lts" target="_blank">Oracle announced to shorten the release cycle</a>.</p>
        
        
        
        <p>The releases will, therefore, not be more densely packed than before. In fact, Java 18 is quite manageable and does not contain any change to the language itself for a long time (after numerous language extensions like <a href="/java/records/">records</a> and <a href="/java/sealed-classes/">sealed classes</a>).</p>
        
        
        
        <p>The main changes of Java 18 are:</p>
        
        
        
        <ul>
        <li>UTF-8 will be the default character set on all operating systems in the future, regardless of language and locale settings.</li>
        
        
        
        <li>Using the <code>jwebserver</code> command (or the <code>SimpleFileServer</code> class), we can quickly start a rudimentary web server.</li>
        
        
        
        <li>With the <code>@snippet</code> tag, we get a powerful tool to integrate source code snippets into our JavaDoc documentation.</li>
        
        
        
        <li>With the "Internet-Address Resolution SPI", we can replace the standard resolver for IP addresses, which is especially helpful in tests.</li>
        
        
        
        <li>The preview and incubator features "Pattern Matching for switch", "Vector API", and "Foreign Function &amp; Memory API" were each sent to the next preview or incubator round.</li>
        
        
        
        <li>Finalization and <code>Thread.stop()</code> have been marked "deprecated for removal".</li>
        </ul>
        
        
        
        <p>As always, various other changes round out the release. You can download Java 18 <a rel="noopener" href="https://jdk.java.net/18/" target="_blank">here</a>.</p>
        
        
        
        <p>You don't want to miss any HappyCoders.eu article? Then <a href="#" data-formkit-toggle="bebaa18901">click here</a> to sign up for the free HappyCoders newsletter.</p>
        </div>
</body>
</html>